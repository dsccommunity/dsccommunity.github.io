<head>
  <meta charset="utf-8">
  <title>Testing Guidelines</title>

  <meta name="generator" content="Hugo 0.64.1" />

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-144465379-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  <!-- ** Plugins Needed for the Project ** -->
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://dsccommunity.org/plugins/bootstrap/bootstrap.min.css">
  <!-- themefy-icon -->
  <link rel="stylesheet" href="https://dsccommunity.org/plugins/themify-icons/themify-icons.css">
  <!-- highlight -->
  <link rel="stylesheet" href="https://dsccommunity.org/plugins/highlight/hybrid.css">
  <!-- fonts -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">


  <style>
  :root{
    --primary-color:#003366;
    --secondary-color:#f9f9f9;
    --text-color:#242738;
    --text-color-dark:#000;
    --white-color:#ffffff;
  }
  </style>

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://dsccommunity.org/css/style.min.css" integrity="" media="screen">

  <!-- jquiry -->
  <script src="https://dsccommunity.org/plugins/jquery/jquery-1.12.4.js"></script>

  <!-- jquary ui -->
  <script src="https://dsccommunity.org/plugins/jquery/jquery-ui.js"></script>

  <!--Favicon-->
  <link rel="icon" href="https://dsccommunity.org/images/favicon.png" type="image/x-icon">

</head>

<!-- navigation -->
<header class="shadow-bottom sticky-top bg-white">
  <div class="container">
    <nav class="navbar navbar-expand-lg navbar-light">
  <a class="navbar-brand" href="https://dsccommunity.org/">DSC Community and Resource Kit</a>
  <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation"
    aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse text-center" id="navigation">
    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link text-dark" href="https://dsccommunity.org/">Home</a>
      </li>
      
      
      <li class="nav-item">
          <a class="nav-link text-dark" href="/code_of_conduct">Code of Conduct</a>
      </li>
      
      
      
      <li class="nav-item">
          <a class="nav-link text-dark" href="/community_calls">Community Calls</a>
      </li>
      
      
      
      <li class="nav-item">
          <a class="nav-link text-dark" href="/faq">Faq</a>
      </li>
      
      
      
      <li class="nav-item">
          <a class="nav-link text-dark" href="/help">help</a>
      </li>
      
      
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle text-dark" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
          aria-expanded="false">
          Categories
        </a>
        <div class="dropdown-menu" >
          
          <a class="dropdown-item" href="/community">Community</a>
          
          <a class="dropdown-item" href="/resources">Resource Modules</a>
          
          <a class="dropdown-item" href="/guidelines">Guidelines</a>
          
          <a class="dropdown-item" href="/blog">Blog Posts</a>
          
          <a class="dropdown-item" href="/configmgt">Config. Management</a>
          
        </div>
      </li>
      
      
    </ul>
    
    <ul class="list-inline text-center mb-0">
      
    </ul>
  </div>
</nav>
  </div>
</header>
<!-- /navigation -->


<section class="single pt-5 bg-gray">
  <div class="container">
    <div class="row">
      <div class="col-lg-3">
        <div class="p-4 bg-white sticky-top top-100">
            
            <nav class="sidebar-menu">
              <ul class="list-styled">
            <li class=""><a href="/community/">Community</a>
              <ul class="">
            <li class=""><a href="/community/origin-story/">Origin Story</a>
            </li>
            <li class=""><a href="/community/ownership/">Ownership of DSC Resources</a>
            </li>
            <li class=""><a href="/community/committee/">DSC Community Committee</a>
            </li>
            <li class=""><a href="/community/maintainers/">Maintainers</a>
            </li>
            <li class=""><a href="/community/contact/">Join the Conversation</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/resources/">Resource Modules</a>
            </li>
            <li class="parent d-block "><a href="/guidelines/">Guidelines</a>
              <ul class="sub-menu">
            <li class=""><a href="/guidelines/getting-started/">Getting Started as a Contributor</a>
            </li>
            <li class=""><a href="/guidelines/contributing/">Contributing</a>
            </li>
            <li class=""><a href="/guidelines/maintaining/">Maintaining</a>
            </li>
            <li class=""><a href="/guidelines/style-guidelines/">Style Guidelines</a>
            </li>
            <li class=" active "><a href="/guidelines/testing-guidelines/">Testing Guidelines</a>
            </li>
            <li class=""><a href="/guidelines/administration/">Administration</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/styleguidelines/">Style Guidelines</a>
              <ul class="">
            <li class=""><a href="/styleguidelines/markdown-files/">Markdown Files</a>
            </li>
            <li class=""><a href="/styleguidelines/general/">General</a>
            </li>
            <li class=""><a href="/styleguidelines/whitespace/">Whitespace</a>
            </li>
            <li class=""><a href="/styleguidelines/functions/">Functions</a>
            </li>
            <li class=""><a href="/styleguidelines/parameters/">Parameters</a>
            </li>
            <li class=""><a href="/styleguidelines/variables/">Variables</a>
            </li>
            <li class=""><a href="/styleguidelines/general-best-practices/">General Best Practices</a>
            </li>
            <li class=""><a href="/styleguidelines/calling-functions/">Calling Functions</a>
            </li>
            <li class=""><a href="/styleguidelines/writing-functions/">Writing Functions</a>
            </li>
            <li class=""><a href="/styleguidelines/dsc-resource-functions/">Dsc Resource Functions</a>
            </li>
            <li class=""><a href="/styleguidelines/manifest/">Manifest</a>
            </li>
            <li class=""><a href="/styleguidelines/localization/">Localization</a>
            </li>
            <li class=""><a href="/styleguidelines/pester-tests/">Pester Tests</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/blog/">Blog Posts</a>
              <ul class="">
            <li class=""><a href="/blog/create-an-article/">Create an Article</a>
            </li>
            <li class=""><a href="/blog/add-codecov-support-to-repository/">Add Codecov Support to Repository</a>
            </li>
            <li class=""><a href="/blog/use-dscresource-common-functions-in-module/">DscResource.Common functions in a DSC module</a>
            </li>
            <li class=""><a href="/blog/convert-a-module-for-continuous-delivery/">Steps to convert a module for continuous delivery</a>
            </li>
            <li class=""><a href="/blog/how-to-use-dsc-logging/">How to Use Dsc Logging</a>
            </li>
            <li class=""><a href="/blog/dsc-maintenance-windows/">Realizing maintenance windows with DSC</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/configmgt/">Configuration Management</a>
              <ul class="">
            <li class=""><a href="/configmgt/future-of-config-mgt/">Future of Configuration Management</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/community_calls/">Community Calls</a>
              <ul class="">
            <li class=""><a href="/community_calls/next_call/">Next Community Call 2020-02-26</a>
            </li>
            <li class=""><a href="/community_calls/2020-01-22-notes/">2020-01-22 Notes</a>
            </li>
            <li class=""><a href="/community_calls/2019-12-04-notes/">2019-12-04 Notes</a>
            </li>
            <li class=""><a href="/community_calls/2019-10-23-notes/">2019-10-23 Notes</a>
            </li>
            <li class=""><a href="/community_calls/2019-09-11-notes/">2019-09-11 Notes</a>
            </li>
            <li class=""><a href="/community_calls/2019-07-31-notes/">2019-07-31 Notes</a>
            </li>
            <li class=""><a href="/community_calls/2019-06-19-notes/">2019-06-19 Notes</a>
            </li>
            <li class=""><a href="/community_calls/2019-05-08-notes/">2019-05-08 Notes</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/code_of_conduct/">Code of Conduct</a>
              <ul class="">
            <li class=""><a href="/code_of_conduct/standards/">Our Standards</a>
            </li>
            <li class=""><a href="/code_of_conduct/responsibilities/">Our Responsibilities</a>
            </li>
            <li class=""><a href="/code_of_conduct/scope/">Scope</a>
            </li>
            <li class=""><a href="/code_of_conduct/enforcement/">Enforcement</a>
            </li>
            <li class=""><a href="/code_of_conduct/common_questions/">Common Questions</a>
            </li>
            <li class=""><a href="/code_of_conduct/attribution/">Attribution</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/help/">Help</a>
              <ul class="">
            <li class=""><a href="/help/what-is-dsc/">What is Desired State Configuration</a>
            </li>
            <li class=""><a href="/help/what-future-for-dsc/">What Future for Dsc</a>
            </li></ul>
              
            </li>
            <li class=""><a href="/contributors/">Elements</a>
            </li>
            <li class=""><a href="/faq/">Frequently Asked Questions</a>
            </li></ul>
            </nav>

            
        </div>
      </div>
      <div class="col-lg-9">
        <div class="p-5 bg-white">
            <h2>Testing Guidelines</h2>
            <h3 id="general-rules">General Rules</h3>
<ul>
<li>Tests are written using <a href="https://github.com/pester/Pester">Pester</a>.</li>
<li>Preferably use the concept of
<a href="https://en.wikipedia.org/wiki/Test-driven_development">test-driven development</a>
when writing tests.</li>
<li>Each DSC module should contain the following Test folder structure:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">       tests
       |---Unit
       |---Integration
</code></pre></div><ul>
<li>The <code>tests\Unit</code> folder must contain a Test Script for each DSC Resource in the
DSC Module with the filename <code>DSC_&lt;ResourceName&gt;.Tests.ps1</code>.</li>
<li>The <code>tests\Integration</code> folder should, whenever possible, contain a Test Script
for each DSC Resource in the DSC Module with the filename <code>DSC_&lt;ResourceName&gt;.integration.Tests.ps1</code>.</li>
<li>Each Test Script should contain <a href="https://github.com/pester/Pester">Pester</a> based
tests.</li>
<li>Integration tests should be created when possible, but for some DSC resources
this may not be possible. For example, when integration tests would cause the
testing computer configuration to be damaged.</li>
<li>Unit and Integration tests templates should be created using the Plaster template
that is generated by the <a href="https://github.com/gaelcolas/Sampler">Sampler</a>
project.</li>
<li>The Unit and Integration test templates are dependent on the CI pipeline
that is generated by the DSC module Plaster template that is generated by the
<a href="https://github.com/gaelcolas/Sampler">Sampler</a> project. That template
contain a CI pipeline that when configured it will help get the
dependencies to run the tests.</li>
</ul>
<h3 id="creating-dsc-resource-unit-test-instructions">Creating DSC Resource Unit Test Instructions</h3>
<p>Not yet written. This should be done through the Plaster template in the
<a href="https://github.com/gaelcolas/Sampler">Sampler</a> project.</p>
<h3 id="creating-dsc-resource-integration-test-instructions">Creating DSC Resource Integration Test Instructions</h3>
<p>Not yet written. This should be done through the Plaster template in the
<a href="https://github.com/gaelcolas/Sampler">Sampler</a> project.</p>
<h3 id="updating-dsc-resource-tests">Updating DSC Resource Tests</h3>
<p>It is possible that the Unit and Integration test templates may change in future,
either to support new functionality or fix an issue. When a change is made to a
template, it will be documented in the <a href="https://github.com/gaelcolas/Sampler/blob/master/CHANGELOG.md">change log of the repository Sampler</a>.
To get the changes generate a new DSC module template from the Plaster template
in the <a href="https://github.com/gaelcolas/Sampler">Sampler</a> project.</p>
<h3 id="dsc-resource-hqrm-tests">DSC Resource HQRM Tests</h3>
<p>The HQRM tests are present in the repository <a href="https://github.com/dsccommunity/DscResource.Test">DSCResource.Test</a>.
The DSC module template will by default use the HQRM tests in this repository.</p>
<p>It is very likely that the DSC resource HQRM tests will be updated
in the future and that will be documented in the <a href="https://github.com/dsccommunity/DscResource.Test/blob/master/CHANGELOG.md">change log of the repository DscResource.Test</a>.
The CI test pipeline defaults to opt-in to all tests so there are no need
to do anything to get new functionality in the DSC modules.</p>
<h3 id="opt-out-from-tests">Opt-Out from Tests</h3>
<p>Default is that all the tests are opted-in. If a test cannot be resolved
to pass then there are different scenarios supported to opt-out from tests.
Preferably you should opt-out from tests.</p>
<ul>
<li>Configuring the <code>build.yaml</code> with the tag <code>ExcludeTag</code> under either the
key <code>Pester</code> or <code>DscTest</code> (JSON files override excludes for the key
<code>DscTest</code>).
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">Pester:
  ExcludeTag:
    - <span style="color:#e6db74">&#39;TagOnUnitTest&#39;</span>

DscTest:
  ExcludeTag:
    - Common Tests - New Error-Level Script Analyzer Rules
    - Common Tests - Validate Example Files
    - Common Tests - Relative Path Length
</code></pre></div></li>
</ul>
<h4 id="default-opt-outs">Default opt-outs</h4>
<h5 id="test-new-error-level-script-analyzer-rules">Test &ldquo;New Error-Level Script Analyzer Rules&rdquo;</h5>
<p>This HQRM tests is opt-out by default since it tests the ScriptAnalyzer
rules <code>PSDSCDscExamplesPresent</code> and <code>PSDSCDscTestsPresent</code> which does not
currently work with the folder structure needed by CI pipeline.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">DscTest:
    ExcludeTag:
    - <span style="color:#e6db74">&#39;Common Tests - New Error-Level Script Analyzer Rules&#39;</span>
</code></pre></div><p>Even if opt-out this test will still run. You opt-out from the test phase
failing if there are any violations. Noteworthy is also that if there are
violations the opt-out test will be skipped (yellow), if there are no
violations the test will pass (green).</p>
<h3 id="pinning-version-of-prerequisites-module">Pinning version of prerequisites module</h3>
<p>Not yet written.</p>
<h3 id="running-tests">Running Tests</h3>
<p>If configured, all tests are automatically run using the CI pipeline via
Azure Pipelines in the DSC Community Azure DevOps organization when
updating the upstream repository.</p>
<h4 id="running-tests-locally">Running Tests Locally</h4>
<p>It is recommended that all tests be run locally before being committed.</p>
<p>Regardless of the method of running the tests you must always resolve the
dependencies first. After that you must build the module.</p>
<ol>
<li><a href="/guidelines/contributing#resolve-dependencies">Resolve dependencies</a></li>
<li><a href="/guidelines/contributing#build-module">Build module</a></li>
</ol>
<blockquote>
<p><strong>NOTE!</strong> Each time a source file changes you must re-build the module before
running tests again. This is because the tests are always run against the
built module in the &lsquo;output&rsquo; folder, not the modules source files.</p>
</blockquote>
<blockquote>
<p><strong>KNOWN ISSUE:</strong> If the DSC resources are importing a module from the folder
<code>Modules</code> (common module), the common module is already imported if you
run the tests a second time. That means that any changes that you make to
the common module are not reflected in the test run. To workaround this
the common module have to be manually removed using <code>Remove-Module -Name 'ModuleName'</code>.
There are a second workaround, force import the module in the DSC resources.
Force importing the module are not recommended due to performance and could
have a big impact in production.</p>
</blockquote>
<h5 id="running-tests-locally-using-pipeline">Running Tests Locally Using Pipeline</h5>
<p><strong>Remember to run the build task if any file has been changed in the source</strong>
<strong>folder.</strong></p>
<p>This runs <em>all</em> the tests for the module. <strong>BE AWARE: This may be configured</strong>
<strong>to run integration tests too if they exist! Integration tests may disrupt</strong>
<strong>the system configuration temporarily, leave system changed, or may require</strong>
<strong>specific dependencies to execute.</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">.\build.ps1 -Tasks test
</code></pre></div><p>This will just run the unit tests for the module using code coverage.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">.\build.ps1 -Tasks test -PesterScript <span style="color:#e6db74">&#39;tests/Unit&#39;</span>
</code></pre></div><p>This will just run the integration tests for the module without code coverage.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">.\build.ps1 -Tasks test -PesterScript <span style="color:#e6db74">&#39;tests/Integration&#39;</span> -CodeCoverageThreshold 0
</code></pre></div><h5 id="running-tests-locally-using-invoke-pester">Running Tests Locally Using Invoke-Pester</h5>
<p>Not yet written.</p>
<h5 id="running-tests-locally-within-visual-studio-code">Running Tests Locally Within Visual Studio Code</h5>
<p>Not yet written.</p>
<h4 id="running-tests-in-free-azure-devops-organization">Running tests in free Azure DevOps organization</h4>
<p>If you have <a href="/guidelines/contributing/#attach-your-fork-to-a-free-azure-devops-organization">Attached your fork to a free Azure DevOps organization</a>
then for each commit that is pushed to your working branch in your fork
the pipeline will be run.</p>
<h5 id="re-run-failed-jobs">Re-run failed jobs</h5>
<p>It is possible to re-run failed jobs in the Azure Pipeline. Be aware that
in some circumstances it caches dependencies so even re-running a failed
jobs that you know will pass it will not. Instead start a new job from the
commit in question. If it is a pull request (PR) that failed push another
change to the PR, or close and directly reopen the PR.</p>
<h3 id="unit-testing-private-functions">Unit Testing Private Functions</h3>
<p>If a resource contains private (non-exported) functions that need to be tested,
then to allow these functions to be tested by Pester, they must be contained
in an <code>InModuleScope</code> Pester block:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">InModuleScope $script:dscResourceName {
    Describe <span style="color:#e6db74">&#34;</span>$($script:dscResourceName)<span style="color:#e6db74">\Get-FirewallRuleProperty</span><span style="color:#e6db74">&#34;</span> {
        <span style="color:#75715e"># Test Get-FirewallRuleProperty private/non-exported function</span>
    }
}
</code></pre></div><p><em>Note: The core DSC Resource functions <code>Get-TargetResource</code>, <code>Set-TargetResource</code>
and <code>Test-TargetResource</code> must always be public functions, so they do not
need to be contained in an <code>InModuleScope</code> block.</em></p>
<h3 id="using-variables-declared-by-the-module-in-tests">Using Variables Declared by the Module in Tests</h3>
<p>It is common for modules to declare variables that are needed inside the module,
but may also be required for unit testing. One common example of this is the
<code>$script:localizedData</code> variable that contains localized messages used by the
resource. Variables declared at the module scope (private variables) can not
be accessed by unit tests that are not inside an <code>InModuleScope</code> Pester block.</p>
<blockquote>
<p><strong>Note:</strong> See <a href="/styleguidelines/localization/">Localization</a> section for
more information of using localized messages in tests.</p>
</blockquote>
<p>There are three solutions to this:</p>
<ol>
<li>
<p>Run the tests inside a <code>InModuleScope</code> which give access to all
script scope variables like <code>$script:localizedData</code>.</p>
</li>
<li>
<p>Use the <code>InModuleScope</code> to copy the private variable into a variable
scoped to the Unit test:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$localizedData = InModuleScope $script:dscResourceName {
    $script:localizedData
}
</code></pre></div></li>
<li>
<p>Add any variables that are required to be accessed outside the module
by unit tests to the <code>Export-ModuleMember</code> cmdlet in the DSC Resource:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">Export-ModuleMember -Function *-TargetResource -Variables LocalizedData
</code></pre></div></li>
</ol>
<h3 id="creating-mock-output-variables-without-inmodulescope">Creating Mock Output Variables without InModuleScope</h3>
<p>One useful pattern used when creating unit tests is to create variables that
contain objects that will be returned when mocked cmdlets are called.
These variables are often used many times over a single unit test file and so
assigning each to a variable is essential to reduce the size of the unit test as
well as improve readability and maintainability.
For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$MockNetAdapter = @{
    Name              = <span style="color:#e6db74">&#39;Ethernet&#39;</span>
    PhysicalMediaType = <span style="color:#e6db74">&#39;802.3&#39;</span>
    Status            = <span style="color:#e6db74">&#39;Up&#39;</span>
}

<span style="color:#75715e"># Create a mock</span>
Mock `
    -CommandName Get-NetAdapter `
    -MockWith { <span style="color:#66d9ef">return</span> $MockNetAdapter }
</code></pre></div><p>However, when <code>InModuleScope</code> is being used the variables that are defined won&rsquo;t
be accessible from within the mocked cmdlets. The solution to this is create a script
block variable that contains the mocked object and then assign that to the Mock.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$GetNetAdapter_PhysicalNetAdapterMock = {
    <span style="color:#66d9ef">return</span> @{
        Name              = <span style="color:#e6db74">&#39;Ethernet&#39;</span>
        PhysicalMediaType = <span style="color:#e6db74">&#39;802.3&#39;</span>
        Status            = <span style="color:#e6db74">&#39;Up&#39;</span>
    }
}

<span style="color:#75715e"># Create a mock</span>
Mock `
    -CommandName Get-NetAdapter `
    -ModuleName $script:ModuleName `
    -MockWith $GetNetAdapter_PhysicalNetAdapterMock
</code></pre></div><h3 id="example-unit-test-patterns">Example Unit Test Patterns</h3>
<p>Pattern 1:
The goal of this pattern should be to describe the potential states a system could
be in for each function.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">        Describe <span style="color:#e6db74">&#39;Get-TargetResource&#39;</span> {
            <span style="color:#75715e"># TODO: Complete Get-TargetResource Tests...</span>
        }

        Describe <span style="color:#e6db74">&#39;Set-TargetResource&#39;</span> {
            <span style="color:#75715e"># TODO: Complete Set-TargetResource Tests...</span>
        }

        Describe <span style="color:#e6db74">&#39;Test-TargetResource&#39;</span> {
            <span style="color:#75715e"># TODO: Complete Test-TargetResource Tests...</span>
        }
</code></pre></div><p>Pattern 2:
The goal of this pattern should be to describe the potential states a system
could be in so that the get/set/test cmdlets can be tested in those states.
Any mocks that relate to that specific state can be included in the relevant
Describe block. For a more detailed description of this approach please review #143</p>
<p>Add as many of these example &lsquo;states&rsquo; as required to simulate the scenarios that
the DSC resource is designed to work with, below a simple &lsquo;is in desired state&rsquo;
and &lsquo;is not in desired state&rsquo; are used, but there may be more complex combinations
of factors, depending on how complex your resource is.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">Describe <span style="color:#e6db74">&#39;The system is not in the desired state&#39;</span> {
    <span style="color:#75715e">#TODO: Mock cmdlets here that represent the system not being in the desired state</span>

    <span style="color:#75715e">#TODO: Create a set of parameters to test your get/set/test methods in this state</span>
    $testParameters = @{
        Property1 = <span style="color:#e6db74">&#39;value&#39;</span>
        Property2 = <span style="color:#e6db74">&#39;value&#39;</span>
    }

    <span style="color:#75715e">#TODO: Update the assertions below to align with the expected results of this state</span>
    It <span style="color:#e6db74">&#39;Should return something&#39;</span> {
        Get-TargetResource @testParameters | Should -Be <span style="color:#e6db74">&#39;something&#39;</span>
    }

    It <span style="color:#e6db74">&#39;Should return false&#39;</span> {
        Test-TargetResource @testParameters | Should -Be $false
    }

    It <span style="color:#e6db74">&#39;Should call Demo-CmdletName&#39;</span> {
        Set-TargetResource @testParameters

        <span style="color:#75715e">#TODO: Assert that the appropriate cmdlets were called</span>
        Assert-MockCalled Demo-CmdletName
    }
}

Describe <span style="color:#e6db74">&#39;The system is in the desired state&#39;</span> {
    <span style="color:#75715e">#TODO: Mock cmdlets here that represent the system being in the desired state</span>

    <span style="color:#75715e">#TODO: Create a set of parameters to test your get/set/test methods in this state</span>
    $testParameters = @{
        Property1 = <span style="color:#e6db74">&#39;value&#39;</span>
        Property2 = <span style="color:#e6db74">&#39;value&#39;</span>
    }

    <span style="color:#75715e">#TODO: Update the assertions below to align with the expected results of this state</span>
    It <span style="color:#e6db74">&#39;Should return something&#39;</span> {
        Get-TargetResource @testParameters | Should -Be <span style="color:#e6db74">&#39;something&#39;</span>
    }

    It <span style="color:#e6db74">&#39;Should return true&#39;</span> {
        Test-TargetResource @testParameters | Should -Be $true
    }
}
</code></pre></div><p>To see examples of the Unit/Integration tests in practice, see the NetworkingDsc
MSFT_DhcpClient resource:</p>
<ul>
<li><a href="https://github.com/dsccommunity/NetworkingDsc/blob/master/Tests/Unit/MSFT_DhcpClient.Tests.ps1">Unit Tests</a></li>
<li><a href="https://github.com/dsccommunity/NetworkingDsc/blob/master/Tests/Integration/MSFT_DhcpClient.Integration.Tests.ps1">Integration Tests</a>
<ul>
<li><a href="https://github.com/dsccommunity/NetworkingDsc/blob/master/Tests/Integration/MSFT_DhcpClient.config.ps1">Integration Tests resource DSC Configuration</a></li>
</ul>
</li>
</ul>
<h3 id="localization">Localization</h3>
<p>When resources use localization (which all normally should) there is the
possibility to use the localized messages in the tests. This is normally used
to verify the correct error messages are thrown. But could be used
for verbose messages, warning messages, and of course any other types.</p>
<p>When using the
<a href="/styleguidelines/localization#get-localizeddata"><code>Get-LocalizedData</code></a>
helper function to load the localized strings into <code>$script:localizedData</code> in
the resource module script file, the strings can easily be used like this in
tests.</p>
<blockquote>
<p><strong>Note:</strong> For this to work the test (the It-block) must be inside a
<code>InModuleScope</code>-block.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">It <span style="color:#e6db74">&#39;Should throw the correct error message&#39;</span> {
    {
        Set-TargetResource @setTargetResourceParameters
    } | Should -Throw $script:localizedData.DatabaseMailDisabled
}
</code></pre></div><h4 id="helper-functions-for-testing-localization">Helper functions for testing localization</h4>
<p>There are two helper functions to simplify testing localized error messages.
The helper functions can be used to build a correct localized error record to
be used in the tests. They are used together with the
<a href="/styleguidelines/localization#helper-functions-for-localization">Helper functions for localization</a>.</p>
<p>These test helper functions can currently only be found in other resource
modules, for example in the resource module NetworkingDsc, in the
<a href="https://github.com/dsccommunity/NetworkingDsc/blob/master/Tests/TestHelpers/CommonTestHelper.psm1">CommonTestHelper</a>
module. To use it, copy the PowerShell module CommonTestHelper.psm1 to the new
resource module.</p>
<h5 id="get-invalidargumentrecord">Get-InvalidArgumentRecord</h5>
<p>This helper function returns an invalid argument exception error object.
Below is an example of how it could look like in the tests to test that the
correct localized error record is returned.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$errorRecord = Get-InvalidArgumentRecord `
    -Message ($script:localizedData.InterfaceNotAvailableError <span style="color:#f92672">-f</span> $interfaceAlias) `
    -ArgumentName <span style="color:#e6db74">&#39;Interface&#39;</span>

It <span style="color:#e6db74">&#39;Should throw an InterfaceNotAvailable error&#39;</span> {
    { Assert-ResourceProperty @testRoute } | Should -Throw $errorRecord
}
</code></pre></div><h5 id="get-invalidoperationrecord">Get-InvalidOperationRecord</h5>
<p>This helper function returns an invalid operation exception error object.
Below is an example of how it could look like in the tests to test that the
correct localized error record is returned.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">$errorRecord = Get-InvalidOperationRecord `
    -Message ($script:localizedData.NetAdapterNotFoundError)

It <span style="color:#e6db74">&#39;Should throw the correct exception&#39;</span> {
    {
        $script:result = Find-NetworkAdapter -Name <span style="color:#e6db74">&#39;NoMatch&#39;</span>
    } | Should -Throw $errorRecord
}
</code></pre></div>
            <p class="post-meta border-bottom pb-3 mb-0">Updated on 01 Jan 0001</p><nav class="pagination mt-3"><a class="nav nav-prev" href="/guidelines/style-guidelines/" title="Style Guidelines"><i class="ti-arrow-left mr-2"></i>Style Guidelines</a>
            <a class="nav nav-next" href="/guidelines/administration/" title="Administration">Administration<i class="ti-arrow-right ml-2"></i></a>
            </nav></div>
      </div>
    </div>
  </div>
</section>


<!-- footer -->
<footer class="section bg-gray pb-0">
  <div class="container">
    <div class="row">
      <div class="col-md-8 text-md-left text-center">
        <p>Copyright 2019 the dsccommunity.org contributors.</p> 
      </div>
      <div class="col-md-4 text-md-right text-center">
        <ul class="list-inline mb-3">
          
          <li class="list-inline-item"><a class="text-color d-inline-block p-2" href="https://github.com/dsccommunity/"><i class="ti-github"></i></a></li>
          
          <li class="list-inline-item"><a class="text-color d-inline-block p-2" href="https://twitter.com/dsccommunity"><i class="ti-twitter-alt"></i></a></li>
          
        </ul>
      </div>
    </div>
  </div>
</footer>
<!-- /footer -->

<!-- Bootstrap JS -->
<script src="https://dsccommunity.org/plugins/bootstrap/bootstrap.min.js"></script>
<!-- highlight -->
<script src="https://dsccommunity.org/plugins/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!-- Main Script -->

<script src="https://dsccommunity.org/js/script.min.js"></script>